(()=>{var e={};e.id=146,e.ids=[146],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1630:e=>{"use strict";e.exports=require("http")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4735:e=>{"use strict";e.exports=require("events")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},5591:e=>{"use strict";e.exports=require("https")},6487:()=>{},7118:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>P,routeModule:()=>k,serverHooks:()=>g,workAsyncStorage:()=>v,workUnitAsyncStorage:()=>y});var s={};t.r(s),t.d(s,{POST:()=>h});var n=t(6559),i=t(8088),a=t(7719),o=t(2190),u=t(7877),c=t(9615),p=t(83),d=t(1501);let l=new u.A(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-03-31.basil"}),m=(e,r)=>{try{let t=(0,c.H)(e),s=(0,c.H)(r);if(s<=t)return 0;return(0,p.m)(s,t)}catch(e){return console.error("Error parsing dates for duration calculation:",e),0}},x=e=>{if(e<=0)return 0;let r=Math.floor(e/30),t=e%30;return Math.min(275*r+Math.min(65*Math.floor(t/7)+t%7*10,65*Math.ceil(t/7),10*t),10*e,65*Math.ceil(e/7),275*Math.ceil(e/30))};async function h(e){try{let{date:r,exitDate:t,duration:s,price:n,licensePlate:i,truckNumber:a}=await e.json();if(!r||!t||!s||!n||!i||!a)return o.NextResponse.json({error:"Missing required booking details"},{status:400});let u=m(r,t),p=parseInt(s,10);if((u<=0||isNaN(p)||u!==p)&&(console.warn(`Duration mismatch/invalid: Client=${s}, Server=${u}. Using server duration.`),u<=0)){if(r===t)return o.NextResponse.json({error:"Entry and Exit dates cannot be the same."},{status:400});return o.NextResponse.json({error:"Invalid entry/exit date combination. Exit date must be after entry date."},{status:400})}let h=x(u),k=parseFloat(n);(isNaN(k)||h!==k)&&console.warn(`Price mismatch: Client=${k}, Server=${h}. Using server price.`);let v=100*h;if(v<=0)return o.NextResponse.json({error:"Calculated price must be positive."},{status:400});let y=(0,d.GP)((0,c.H)(r),"PPP"),g=(0,d.GP)((0,c.H)(t),"PPP"),P=`Truck Parking: ${y} to ${g} (${u} day${1===u?"":"s"}). Plate: ${i}, Truck: ${a}`,f="htpps://www.jrileyparkandpay.com",j=`${f}/confirmation?session_id={CHECKOUT_SESSION_ID}`,w=`${f}/`,_=await l.checkout.sessions.create({payment_method_types:["card"],line_items:[{price_data:{currency:"usd",product_data:{name:"Truck Parking Spot Reservation",description:P,images:[]},unit_amount:v},quantity:1}],mode:"payment",success_url:j,cancel_url:w,metadata:{entryDate:r,exitDate:t,durationDays:u.toString(),licensePlate:i,truckNumber:a}});return o.NextResponse.json({sessionId:_.id})}catch(e){if(console.error("Error creating Stripe session:",e),e instanceof Error)return o.NextResponse.json({error:e.message},{status:500});return o.NextResponse.json({error:"An unknown error occurred"},{status:500})}}let k=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/checkout/route",pathname:"/api/checkout",filename:"route",bundlePath:"app/api/checkout/route"},resolvedPagePath:"/home/user/studio/src/app/api/checkout/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:v,workUnitAsyncStorage:y,serverHooks:g}=k;function P(){return(0,a.patchFetch)({workAsyncStorage:v,workUnitAsyncStorage:y})}},8335:()=>{},8354:e=>{"use strict";e.exports=require("util")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9646:e=>{"use strict";e.exports=require("child_process")}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[447,580,651],()=>t(7118));module.exports=s})();